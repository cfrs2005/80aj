---
title: 100821 php之腾讯微博 Api 修改版
layout: post
permalink: /1482.html
categories:
  - Code
tags:
  - PHP
  - 修改版
  - 腾讯微博Api
---
 自从前2天添加了 wordpress 腾讯微博插件以后,整个网站内容看上去又多了很多，今天无意间看到了 其实很早就有人在网上共享了 查看腾讯微博的php  api代码，在这里 提供我修改后的api ,仅供参考学习. 类需要的 函数库 点击这里下载 我修改的代码如下 你直接复制代码进  tqq.php     即可 md5\_3()函数 腾讯的 密码加密： function md5\_3($str) { return strtoupper(md5(md5(md5($str,true),true))); } tqq.php 我的修改版本 <?php /\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\****\*\\*\* Version: 1.11 ($Rev: 175 $) Website: http://www.115.co Author: S.C. Chen <admin@185.cm> Acknowledge: Jose Solorzano (http://www.115.co/) Contributions by:QQ交流群：89097023 Yousuke Kumakura (Attribute filters) Vadim Voituk (Negative indexes supports of &#8220;find&#8221; method) Antcs (Constructor with automatically load contents either text or file/url) Licensed under The MIT License Redistributions of files must retain the above copyright notice. \*\*\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\***\*****/ //缓存时间，单位：秒 //  blog.80aj.com  可乐烟 做了下封装 getQQWeiBoApp ( &#8220;kuaisubeian&#8221;, &#8220;624D3274815F2237817A7C62F42DD26A&#8221;, 10 ); //帐号 密码  需要显示的数量 function getQQWeiBoApp($weiboName, $weibopwd, $needshow, $t = 1) { if (! is\_file ( &#8216;index.html&#8217; ) || (time () &#8211; filemtime ( &#8216;index.html&#8217; )) > $t) { //微博帐号 $qq = $weiboName; //经过腾讯那个md5\_3()加密后的密码 $pwd = $weibopwd; $verifyURL = &#8216;http://ptlogin2.qq.com/check?uin=@&#8217; . $qq . &#8216;&appid=46000101&#8242;; $loginURL = &#8216;http://ptlogin2.qq.com/login?&#8217;; //获取验证码及第一次cookie $curl = curl\_init ( $verifyURL ); $cookie\_jar = tempnam ( &#8216;.&#8217;, &#8216;cookie&#8217; ); curl\_setopt ( $curl, CURLOPT\_RETURNTRANSFER, 1 ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); $verifyCode = curl\_exec ( $curl ); curl\_close ( $curl ); $verifyCode = strtoupper ( substr ( $verifyCode, 18, 4 ) ); //echo &#8216;验证码：&#8217;.$verifyCode; //echo &#8216;<hr />&#8217;; // echo &#8216;Cookies：&#8217;.$cookie\_jar; // echo &#8216;<hr />&#8217;; //发送登录请求并获取第二次cookie $loginURL .= &#8216;u=@&#8217; . $qq . &#8216;&p=&#8217; . md5 ( $pwd . $verifyCode ) . &#8216;&verifycode=&#8217; . $verifyCode . &#8216;&aid=46000101&u1=http%3A%2F%2Ft.qq.com&h=1&from\_ui=1&fp=loginerroralert&#8217;; //echo &#8216;登录地址：&#8217;.$loginURL; //echo &#8216;<hr />&#8217;; $curl = curl\_init ( $loginURL ); curl\_setopt ( $curl, CURLOPT\_RETURNTRANSFER, 1 ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEFILE, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); $loginResult = curl\_exec ( $curl ); curl\_close ( $curl ); //echo &#8216;登录验证结果：&#8217;.$loginResult; //echo &#8216;<hr />&#8217;; //获取第三次cookie $curl = curl\_init ( &#8216;http://t.qq.com&#8217; ); curl\_setopt ( $curl, CURLOPT\_RETURNTRANSFER, 1 ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEFILE, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); $loginResult = curl\_exec ( $curl ); curl\_close ( $curl ); //第四次 $curl = curl\_init ( &#8216;http://t.qq.com/&#8217; . $qq . &#8216;/mine&#8217; ); curl\_setopt ( $curl, CURLOPT\_RETURNTRANSFER, 1 ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEFILE, $cookie\_jar ); curl\_setopt ( $curl, CURLOPT\_COOKIEJAR, $cookie\_jar ); $loginResult = curl\_exec ( $curl ); curl\_close ( $curl ); unlink ( $cookie\_jar ); file\_put\_contents ( &#8216;index.html&#8217;, $loginResult ); } include (&#8216;cnz.php&#8217;); $html = file\_get\_html ( &#8216;index.html&#8217; ); $talkList = $html->find ( &#8216;#talkList&#8217; ); $lastTalk = $talkList [0]; for($i = 0; $i < $needshow; $i ++) { $userName = $lastTalk->children ( $i ) ->children ( 1 ) ->find ( &#8216;.userName&#8217; ); $msgCnt = $lastTalk->children ( $i ) ->children ( 1 ) ->find ( &#8216;.msgCnt&#8217; ); $pubInfo = $lastTalk->children ( $i ) ->children ( 1 ) ->find ( &#8216;.pubInfo&#8217; ); $userName = $userName [0]->plaintext; $result = &#8221;; //大于二则是转播 echo &#8220;<br>&#8221;; if (count ( $msgCnt ) < 10) { $pi = $pubInfo [0]->find ( &#8216;.left&#8217; ); $result = $userName . $msgCnt [0]->plaintext . &#8216;<p style=&#8221;text-align:center;&#8221;> <span style=&#8221;display:none&#8221;></span></p> <title>blog.80aj.com</title><meta http-equiv=&#8221;content-type&#8221; content=&#8221;text/html; charset=UTF-8&#8243; /><span style=&#8221;font-style: italic; color: rgb(238, 29, 36);&#8221;>&#8217; . $pi [0]->children ( 0 )->plaintext . &#8216; &#8216; . $pi [0]->children ( 1 )->plaintext . &#8216;</span>&#8217;; } else { $pi = $pubInfo [1]->find ( &#8216;.left&#8217; ); $result = $userName . $msgCnt [0]->plaintext . &#8216;[' . $msgCnt [1]->plaintext . &#8216;] <span style=&#8221;font-style: italic; color: rgb(149, 158, 135);&#8221;>&#8217; . $pi [0]->plaintext . &#8216;</span>&#8217;; } echo $result . &#8220;<br>&#8221;; } } ?>