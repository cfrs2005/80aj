---
title: '130201 腾讯微博采集 代码  分享'
layout: post
permalink: /2552.html
categories:
  - Code
tags:
  - demo
  - PHP
  - 腾讯微博
  - 采集
---
前段时间看有人在做关于美女图片的采集 ，随自己随手写了个 ，发现正则真的是薄弱了，哎 不知道为什么正则的规则一直记不住 why ? 腾讯微博代码采集Demo非API接口 $str = "比基尼"; $url = "http://k.t.qq.com/k/" . urlencode($str); $html\_list = get\_html($url); preg\_match("/\<ul id=\"talkList\" class=\"LC\"\>(.+?)\<\/li\>\<\/ul\>/ms", $html\_list, $preg\_list); $str\_arr = $preg\_list\[0]; preg\_match\_all("/\<div class=\"msgCnt\"\>(.+?)\<\/div\>(.+?)\<div class=\"picBox \"\>\<a href=\"(.+?)\" target=\"\_blank/ms", $str\_arr, $new\_arr); for($i = 0;$i < count($new\_arr[1]);$i++) { echo strip\_tags($new\_arr[1\]\[$i\]) . "<img src='" . $new\_arr\[3\]\[$i\] . "'><br>"; } function get\_html($url) { while (true) { $ch = curl\_init(); curl\_setopt($ch, CURLOPT\_URL, $url); curl\_setopt($ch, CURLOPT\_TIMEOUT, 3); curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, true); curl\_setopt($ch, CURLOPT\_USERAGENT, "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"); curl\_setopt($ch, CURLOPT\_COOKIE, "TIEBAPB=OLDPB"); $html = curl\_exec($ch); curl\_close($ch); if (!empty($html)) { return $html; } sleep(1); } }