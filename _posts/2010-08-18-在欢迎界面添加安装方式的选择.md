---
title: 在欢迎界面添加安装方式的选择
layout: post
permalink: /1440.html
categories:
  - Code
tags:
  - 80s
  - 80slife
  - nsis
  - 欢迎界面
  - 添加安装方式
  - 选择
---
 之前有位朋友问我如何实现下面的界面效果，我借鉴了一下ansifa的方法，完成界面上控件的初步实现，如下图效果： 分享代码如下： SetCompressor /SOLID lzma SetCompressorDictSize 32 XPStyle on Name &#8220;Welcome\_setuptype&#8221; OutFile &#8220;Welcome\_setuptype.exe&#8221; !include &#8220;MUI.nsh&#8221; ;页面自定义函数 !define MUI\_PAGE\_CUSTOMFUNCTION\_PRE Pre !define MUI\_PAGE\_CUSTOMFUNCTION\_SHOW Show !define MUI\_PAGE\_CUSTOMFUNCTION\_LEAVE leave ; 欢迎页面 !insertmacro MUI\_PAGE\_WELCOME ;选择安装方式&#8221; &#8220;请选择软件的安装方式。&#8221; !insertmacro MUI\_PAGE\_COMPONENTS ; 安装目录选择页面 !insertmacro MUI\_PAGE\_DIRECTORY ; 安装过程页面 !insertmacro MUI\_PAGE\_INSTFILES ; 安装界面包含的语言设置 !insertmacro MUI\_LANGUAGE &#8220;SimpChinese&#8221; Function pre !insertmacro MUI\_INSTALLOPTIONS\_READ $0 &#8220;ioSpecial.ini&#8221; &#8220;Settings&#8221; &#8220;Numfields&#8221; ;读取控件数目 IntOp $R0 $0 + 4  ;添加4个控件 !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 3&#8243; &#8220;Text&#8221; &#8220;这个向导将指引你完成安装：&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 3&#8243; &#8220;Bottom&#8221; &#8220;60&#8243;    ;修小原有的文字框，避免遮盖 !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Settings&#8221; &#8220;Numfields&#8221; &#8220;$R0&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Type&#8221; &#8220;RadioButton&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;State&#8221; &#8220;1&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Text&#8221; &#8220;标准安装&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Flags&#8221; &#8220;&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Left&#8221; &#8220;120&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Right&#8221; &#8220;168&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Top&#8221; &#8220;70&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 4&#8243; &#8220;Bottom&#8221; &#8220;85&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Type&#8221; &#8220;RadioButton&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;State&#8221; &#8220;0&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Text&#8221; &#8220;自定义安装&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Flags&#8221; &#8220;&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Left&#8221; &#8220;120&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Right&#8221; &#8220;178&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Top&#8221; &#8220;120&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 5&#8243; &#8220;Bottom&#8221; &#8220;135&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Type&#8221; &#8220;Label&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Text&#8221; &#8220;本软件将安装到：\r\nC:\\Program Files\\software&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Left&#8221; &#8220;130&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Right&#8221; &#8220;250&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Top&#8221; &#8220;90&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 6&#8243; &#8220;Bottom&#8221; &#8220;110&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Type&#8221; &#8220;Label&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Text&#8221; &#8220;自定义所有的安装选项，推荐有经验的用户使用&#8221; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Left&#8221; &#8220;130&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Right&#8221; &#8220;300&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Top&#8221; &#8220;140&#8243; !insertmacro MUI\_INSTALLOPTIONS\_WRITE &#8220;ioSpecial.ini&#8221; &#8220;Field 7&#8243; &#8220;Bottom&#8221; &#8220;150&#8243; FunctionEnd Function show Push $0 GetDlgItem $0 $MUI\_HWND 1203 SetCtlColors $0 &#8220;000000&#8243; &#8220;FFFFFF&#8221; ;设置控件背景为白白，文字为黑色 GetDlgItem $0 $MUI\_HWND 1204 SetCtlColors $0 &#8220;000000&#8243; &#8220;FFFFFF&#8221; GetDlgItem $0 $MUI\_HWND 1205 SetCtlColors $0 &#8220;000000&#8243; &#8220;FFFFFF&#8221; GetDlgItem $0 $MUI\_HWND 1206 SetCtlColors $0 &#8220;000000&#8243; &#8220;FFFFFF&#8221; Pop $0 FunctionEnd Function leave ReadINIStr $R0 &#8220;$PLUGINSDIR\ioSpecial.ini&#8221; &#8220;Field 4&#8243; State ;读取控件的状态，这里是读取 StrCmp $R0 &#8220;1&#8243; 0 +2 MessageBox MB\_OK &#8220;标准安装（推荐）&#8221; ReadINIStr $R0 &#8220;$PLUGINSDIR\ioSpecial.ini&#8221; &#8220;Field 5&#8243; State StrCmp $R0 &#8220;1&#8243; 0 +2 MessageBox MB\_OK &#8220;自定义安装&#8221; FunctionEnd Section &#8220;-Dreams8&#8243; SectionEnd